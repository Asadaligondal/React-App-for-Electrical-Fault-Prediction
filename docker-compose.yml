services:
  mongodb:
    image: mongo:7.0
    container_name: mongodb
    ports: ["27017:27017"]
    environment:
      - MONGO_INITDB_ROOT_USERNAME=admin
      - MONGO_INITDB_ROOT_PASSWORD=password123
    volumes: [mongodb_data:/data/db]
    networks: [motornet]
    restart: unless-stopped

  ai-service:
    build:
      context: ./ai-service
      dockerfile: Dockerfile
    container_name: ai-service
    ports: ["8001:8001"]
    networks: [motornet]
    restart: unless-stopped

  udp-service:
    build:
      context: .
      dockerfile: Dockerfile.udp
    container_name: udp-service
    ports: ["3000:3000/udp"]
    environment:
      - AI_SERVICE_URL=http://ai-service:8001
      - MONGODB_URI=mongodb://admin:password123@mongodb:27017/motor_monitoring?authSource=admin
    depends_on: [ai-service, mongodb]
    networks: [motornet]
    restart: unless-stopped

  main-server:
    build:
      context: .
      dockerfile: Dockerfile.server  # ← Make sure this file exists
      # OR use: dockerfile: Dockerfile if you don't have Dockerfile.server
    container_name: main-server
    ports: ["5000:5000"]
    environment:
      - AI_SERVICE_URL=http://ai-service:8001
      - MONGODB_URI=mongodb://admin:password123@mongodb:27017/motor_monitoring?authSource=admin
    depends_on: [udp-service, ai-service, mongodb]
    networks: [motornet]
    restart: unless-stopped

  frontend:
    build:
      context: .
      dockerfile: Dockerfile.frontend  # ← This should be your React Dockerfile
    container_name: frontend
    ports: ["8080:80"]
    depends_on: [main-server]
    networks: [motornet]
    restart: unless-stopped

networks:
  motornet:
    driver: bridge

volumes:
  mongodb_data: